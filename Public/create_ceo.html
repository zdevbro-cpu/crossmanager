<!DOCTYPE html>
<html>

<head>
    <title>Create CEO Account</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase Configuration from .env
        const firebaseConfig = {
            apiKey: "AIzaSyACs6b2VjusQ1AaIyad2iKf7VDfPfurpSk",
            authDomain: "crossmanager-482403.firebaseapp.com",
            projectId: "crossmanager-482403",
            storageBucket: "crossmanager-482403.firebasestorage.app",
            messagingSenderId: "388290195236",
            appId: "1:388290195236:web:9cfe274272dc68d41acdb1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.createAccount = async () => {
            const statusFn = (msg) => document.getElementById('status').innerText = msg;
            statusFn('Processing...');

            const email = 'ceo@cross.com';
            const password = 'cross123';

            try {
                let uid;
                try {
                    const cred = await createUserWithEmailAndPassword(auth, email, password);
                    uid = cred.user.uid;
                    statusFn('User Created in Auth. Setting up DB...');
                } catch (e) {
                    if (e.code === 'auth/email-already-in-use') {
                        statusFn('User already exists. Signing in to update DB...');
                        const cred = await signInWithEmailAndPassword(auth, email, password);
                        uid = cred.user.uid;
                    } else {
                        throw e;
                    }
                }

                await setDoc(doc(db, 'users', uid), {
                    email: email,
                    name: 'CEO',
                    role: 'Manager',
                    allowedSystems: ['PMS', 'EMS', 'SWMS', 'SMS'],
                    createdAt: new Date().toISOString()
                }, { merge: true });

                statusFn('SUCCESS! CEO Account Ready. You can now go to the Portal Login.');
            } catch (error) {
                console.error(error);
                statusFn('ERROR: ' + error.message);
            }
        };
    </script>
</head>

<body style="font-family: sans-serif; padding: 2rem;">
    <h1>Create CEO Account</h1>
    <p>Email: <b>ceo@cross.com</b></p>
    <p>Password: <b>cross123</b></p>
    <button onclick="window.createAccount()" style="padding: 10px 20px; font-size: 1.2rem; cursor: pointer;">Create /
        Repair Account</button>
    <pre id="status" style="margin-top: 20px; background: #eee; padding: 10px;"></pre>
</body>

</html>

import{u as w,a as C,b as D,r as x,j as s}from"./index-Bk_PkX1w.js";import{d as g,e as N}from"./mock-_uwThhGs.js";import{T,P as E}from"./trash-2-1f4s6_-J.js";import"./createLucideIcon-CQVuD4m9.js";const F=async()=>Promise.resolve(g),R=()=>w({queryKey:["resources"],queryFn:F});function S(t,l,c,o){const i=new Date(t).getTime(),r=new Date(l).getTime(),u=new Date(c).getTime(),m=new Date(o).getTime();return!Number.isFinite(i)||!Number.isFinite(r)||!Number.isFinite(u)||!Number.isFinite(m)?!1:i<=m&&u<=r}function b(t){const l=[];for(let c=0;c<t.length;c+=1)for(let o=c+1;o<t.length;o+=1){const i=t[c],r=t[o];S(i.start,i.end,r.start,r.end)&&l.push(`${i.taskId} ↔ ${r.taskId}`)}return l}function B(){const{selectedId:t}=C(),{show:l}=D(),{data:c,isLoading:o,isError:i}=R(),[r,u]=x.useState(g),[m,f]=x.useState(null),[a,h]=x.useState({resourceId:"",taskId:"",start:"",end:""});x.useEffect(()=>{c&&u(c)},[c]);const j=r.filter(e=>!t||e.projectId===t),v=j.map(e=>({...e,conflicts:b(e.assignments)}));x.useEffect(()=>{t&&j[0]&&h(e=>({...e,resourceId:j[0].id}))},[t,j]);const I=async e=>{if(e.preventDefault(),!a.resourceId||!a.taskId||!a.start||!a.end){f("배정 대상/작업/기간을 모두 입력하세요."),l("배정 대상/작업/기간을 모두 입력하세요.","warning");return}u(n=>n.map(d=>{if(d.id!==a.resourceId)return d;const p=[...d.assignments,{taskId:a.taskId,start:a.start,end:a.end}],y=b(p);return{...d,assignments:p,conflicts:y}})),f("배정이 추가되었습니다. (DB 구현 필요)"),l("배정이 추가되었습니다.","success"),h(n=>({...n,taskId:"",start:"",end:""}))},k=async e=>{confirm("삭제하시겠습니까?")&&(u(n=>n.filter(d=>d.id!==e)),f("삭제했습니다. (DB 구현 필요)"),l("삭제했습니다.","success"))};return s.jsxs("div",{className:"page",children:[s.jsxs("header",{className:"section-header",children:[s.jsxs("div",{children:[s.jsx("p",{className:"eyebrow",children:"자원(장비/인력)"}),s.jsx("h2",{children:"공정별 필요 자원 자동 산정과 배차 충돌 체크"}),s.jsx("p",{className:"muted",children:"선택한 프로젝트의 자원을 보며, 배차 충돌을 한눈에 확인하세요."})]}),s.jsx("div",{className:"pill pill-outline",children:"배차 현황 · 충돌 체크"})]}),s.jsxs("section",{className:"card table-card",children:[s.jsxs("div",{className:"table-head",children:[s.jsx("p",{className:"card-label",children:"자원 배정 (선택한 프로젝트)"}),s.jsx("div",{className:"table-actions",children:s.jsx("button",{className:"pill pill-outline",onClick:e=>e.preventDefault(),children:"자원 추가 (아래 폼)"})})]}),m&&s.jsx("p",{className:"muted",children:m}),o&&s.jsx("p",{className:"muted",children:"불러오는 중..."}),i&&s.jsx("p",{className:"muted",children:"불러오기 오류, 새로고침 해주세요."}),s.jsxs("div",{className:"table",children:[s.jsxs("div",{className:"table-row table-header",children:[s.jsx("span",{children:"유형"}),s.jsx("span",{children:"자원명"}),s.jsx("span",{children:"배정"}),s.jsx("span",{children:"충돌"}),s.jsx("span",{children:"관리"})]}),v.map(e=>s.jsxs("div",{className:"table-row",children:[s.jsx("span",{children:e.type}),s.jsx("span",{children:e.name}),s.jsx("span",{children:e.assignments.map(n=>{const d=N.find(p=>p.id===n.taskId)?.name??n.taskId;return s.jsxs("div",{children:[d," (",n.start,"~",n.end,")"]},`${e.id}-${n.taskId}`)})}),s.jsx("span",{children:e.conflicts&&e.conflicts.length?e.conflicts.map(n=>s.jsx("span",{className:"badge badge-alert",children:n},n)):s.jsx("span",{className:"badge",children:"정상"})}),s.jsx("span",{className:"row-actions",children:s.jsx("button",{className:"icon-button",onClick:()=>k(e.id),"aria-label":"삭제",title:"삭제",children:s.jsx(T,{size:18})})})]},e.id))]})]}),s.jsxs("section",{className:"card",children:[s.jsx("p",{className:"card-label",children:"배정 추가"}),s.jsxs("form",{className:"form-grid",onSubmit:I,children:[s.jsxs("label",{children:[s.jsx("span",{children:"자원"}),s.jsxs("select",{value:a.resourceId,onChange:e=>h({...a,resourceId:e.target.value}),children:[s.jsx("option",{value:"",children:"선택"}),j.map(e=>s.jsxs("option",{value:e.id,children:[e.name," (",e.type,")"]},e.id))]})]}),s.jsxs("label",{children:[s.jsx("span",{children:"작업"}),s.jsxs("select",{value:a.taskId,onChange:e=>h({...a,taskId:e.target.value}),children:[s.jsx("option",{value:"",children:"선택"}),N.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("label",{children:[s.jsx("span",{children:"시작"}),s.jsx("input",{type:"date",value:a.start,onChange:e=>h({...a,start:e.target.value})})]}),s.jsxs("label",{children:[s.jsx("span",{children:"종료"}),s.jsx("input",{type:"date",value:a.end,onChange:e=>h({...a,end:e.target.value})})]}),s.jsx("div",{className:"form-actions",children:s.jsx("button",{type:"submit",className:"icon-button","aria-label":"추가",children:s.jsx(E,{size:18})})})]})]}),s.jsxs("section",{className:"grid two",children:[s.jsxs("article",{className:"card",children:[s.jsx("p",{className:"card-label",children:"핵심 기능"}),s.jsxs("ul",{className:"list",children:[s.jsx("li",{children:"작업 요구 자원 자동 계산(장비/인력), 필요량·기간 기반 배차 제안"}),s.jsx("li",{children:"배차 중복/충돌 자동 체크, 경고 배지 표시"}),s.jsx("li",{children:"자원 사용량 분석/시각화 준비"})]})]}),s.jsxs("article",{className:"card",children:[s.jsx("p",{className:"card-label",children:"데이터 키"}),s.jsxs("ul",{className:"list",children:[s.jsxs("li",{children:["`resources`: ","{type, name, projectId, assignments[{taskId, start, end}], conflicts[]}"]}),s.jsx("li",{children:"`resourceUsage` 서브컬렉션으로 일/주 단위 합산 준비"})]})]})]})]})}export{B as default};

import{u as E,a as D,b as S,r as i,j as e}from"./index-Bk_PkX1w.js";import{m as v,a as N}from"./mock-_uwThhGs.js";import{v as k}from"./validation-CKRFn1w2.js";import{u as L}from"./useRole-BP7E3-fT.js";import{P as z,C as B}from"./pencil-D8ZsRbrU.js";import{T as G,P as T}from"./trash-2-1f4s6_-J.js";import"./useProjectMembers-C27NAglr.js";import"./useMutation-qVMx8BuS.js";import"./createLucideIcon-CQVuD4m9.js";const q=async()=>Promise.resolve(v),F=()=>E({queryKey:["contracts"],queryFn:q});function O(){const{selectedId:h}=D(),{show:c}=S(),{data:d,isLoading:g,isError:f}=F(),[y,u]=i.useState(v),[m,j]=i.useState(null),[t,x]=i.useState(null),{role:C}=L(),o=C!=="field";i.useEffect(()=>{d&&u(d)},[d]);const[a,l]=i.useState({projectId:"p1",type:"계약",amount:0,regulation:"삼성",status:"진행"}),I=y.filter(s=>!h||s.projectId===h),w=async s=>{s.preventDefault();const n=k(Number(a.amount)||0);if(n){j(n),c(n,"warning");return}const r={id:t??crypto.randomUUID(),projectId:a.projectId,type:a.type,amount:Number(a.amount)||0,status:a.status,regulation:a.regulation};u(p=>t?p.map(b=>b.id===t?r:b):[r,...p]),j(t?"화면에서 수정했습니다. (DB 구현 필요)":"화면에만 추가했습니다. (DB 구현 필요)"),c(t?"화면에서 수정했습니다.":"화면에만 추가했습니다.","info"),l({...a,amount:0}),x(null)},P=async s=>{if(!o){c("현장근무 역할은 계약/견적 삭제 권한이 없습니다.","warning");return}confirm("삭제하시겠습니까?")&&(u(n=>n.filter(r=>r.id!==s)),j("삭제했습니다. (DB 구현 필요)"),c("삭제했습니다.","success"))};return e.jsxs("div",{className:"page",children:[e.jsxs("header",{className:"section-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"eyebrow",children:"계약 · 견적 · 변경계약"}),e.jsx("h2",{children:"계약 금액과 고객사 규정(삼성/LG) 필드 반영"}),e.jsx("p",{className:"muted",children:"계약/견적/변경계약을 프로젝트에 연결하고, 고객사 규정을 선택해 관리합니다. 회계·결재 기록과 문서 링크까지 연결합니다."})]}),e.jsx("div",{className:"pill pill-outline",children:"회계/결재 흐름"})]}),e.jsxs("section",{className:"card table-card",children:[e.jsxs("div",{className:"table-head",children:[e.jsx("p",{className:"card-label",children:"계약/견적 현황 (샘플)"}),e.jsx("div",{className:"table-actions",children:e.jsx("button",{className:"pill pill-outline",children:"서류 업로드 (준비 중)"})})]}),m&&e.jsx("p",{className:"muted",children:m}),g&&e.jsx("p",{className:"muted",children:"불러오는 중..."}),f&&e.jsx("p",{className:"muted",children:"불러오기 오류, 새로고침 해주세요."}),e.jsxs("div",{className:"table",children:[e.jsxs("div",{className:"table-row table-header",children:[e.jsx("span",{children:"프로젝트"}),e.jsx("span",{children:"구분"}),e.jsx("span",{children:"금액"}),e.jsx("span",{children:"규정"}),e.jsx("span",{children:"상태"}),e.jsx("span",{children:"관리"})]}),I.map(s=>{const n=N.find(r=>r.id===s.projectId);return e.jsxs("div",{className:"table-row",children:[e.jsx("span",{children:n?.name??s.projectId}),e.jsx("span",{children:s.type}),e.jsxs("span",{children:[s.amount.toLocaleString()," 원"]}),e.jsx("span",{children:s.regulation}),e.jsx("span",{className:`badge ${s.status==="완료"?"badge-live":""}`,children:s.status}),e.jsxs("span",{className:"row-actions",children:[e.jsx("button",{className:"icon-button",onClick:()=>{x(s.id),l({projectId:s.projectId,type:s.type,amount:s.amount,status:s.status,regulation:s.regulation})},"aria-label":"편집",title:"편집",children:e.jsx(z,{size:18})}),e.jsx("button",{className:"icon-button",onClick:()=>P(s.id),"aria-label":"삭제",title:"삭제",disabled:!o,children:e.jsx(G,{size:18})})]})]},s.id)})]})]}),e.jsxs("section",{className:"card",children:[e.jsx("p",{className:"card-label",children:t?"계약 수정":"계약 추가"}),!o&&e.jsx("p",{className:"muted",children:"현장근무 역할은 계약/견적 작성 권한이 없습니다."}),e.jsxs("form",{className:"form-grid",onSubmit:w,children:[e.jsxs("label",{children:[e.jsx("span",{children:"프로젝트"}),e.jsx("select",{value:a.projectId,onChange:s=>l({...a,projectId:s.target.value}),children:N.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),e.jsxs("label",{children:[e.jsx("span",{children:"구분"}),e.jsxs("select",{value:a.type,onChange:s=>l({...a,type:s.target.value}),children:[e.jsx("option",{value:"계약",children:"계약"}),e.jsx("option",{value:"견적",children:"견적"}),e.jsx("option",{value:"변경",children:"변경"})]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"금액"}),e.jsx("input",{type:"number",value:a.amount,onChange:s=>l({...a,amount:Number(s.target.value)})})]}),e.jsxs("label",{children:[e.jsx("span",{children:"규정"}),e.jsxs("select",{value:a.regulation,onChange:s=>l({...a,regulation:s.target.value}),children:[e.jsx("option",{value:"삼성",children:"삼성"}),e.jsx("option",{value:"LG",children:"LG"}),e.jsx("option",{value:"기타",children:"기타"})]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"상태"}),e.jsxs("select",{value:a.status,onChange:s=>l({...a,status:s.target.value}),children:[e.jsx("option",{value:"진행",children:"진행"}),e.jsx("option",{value:"검토",children:"검토"}),e.jsx("option",{value:"완료",children:"완료"})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"icon-button","aria-label":"추가",disabled:!o,children:t?e.jsx(B,{size:18}):e.jsx(T,{size:18})})})]})]}),e.jsxs("section",{className:"grid two",children:[e.jsxs("article",{className:"card",children:[e.jsx("p",{className:"card-label",children:"핵심 기능"}),e.jsxs("ul",{className:"list",children:[e.jsx("li",{children:"계약/견적/변경계약 금액 관리, 고객사 규정 필드 포함"}),e.jsx("li",{children:"회계/결재 기록, 문서 링크 연결"}),e.jsx("li",{children:"상태(진행/검토/완료) 배지, 변경 이력 기록"})]})]}),e.jsxs("article",{className:"card",children:[e.jsx("p",{className:"card-label",children:"데이터 키"}),e.jsxs("ul",{className:"list",children:[e.jsxs("li",{children:["`contracts`: ","{projectId, type, amount, regulation, status}"]}),e.jsx("li",{children:"문서 링크/결재 정보 필드 확장 예정"})]})]})]})]})}export{O as default};

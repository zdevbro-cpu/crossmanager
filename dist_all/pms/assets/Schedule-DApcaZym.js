import{a as ce,u as Le,e as We,f as A,b as Pe,r as h,j as t,R as Oe}from"./index-DLDgXF6I.js";import{u as H}from"./useMutation-CV-TupsB.js";import{c as L}from"./createLucideIcon-BDg0D3mO.js";import{P as Xe,T as qe}from"./trash-2-DXkKrmXK.js";import{P as Ae,S as _e}from"./save-DIVjgTYY.js";const Fe=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Be=L("chevron-down",Fe);const Ue=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ye=L("chevron-right",Ue);const He=[["path",{d:"m15 10 5 5-5 5",key:"qqa56n"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]],Ke=L("corner-down-right",He);const Qe=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Ge=L("download",Qe);const Ve=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Ze=L("zoom-in",Ve);const Je=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],et=L("zoom-out",Je),tt=()=>{const{selectedId:p}=ce();return Le({queryKey:["tasks",p],queryFn:async()=>{const v=p?{projectId:p}:{},{data:C}=await A.get("/tasks",{params:v});return C},enabled:!0})},st=()=>{const p=We(),{selectedId:v}=ce(),C=H({mutationFn:async j=>{const{data:N}=await A.post("/tasks",j);return N},onSuccess:()=>{p.invalidateQueries({queryKey:["tasks",v]})}}),K=H({mutationFn:async j=>{const{data:N}=await A.put(`/tasks/${j.id}`,j);return N},onSuccess:()=>{p.invalidateQueries({queryKey:["tasks",v]})}}),Q=H({mutationFn:async j=>(await A.delete(`/tasks/${j}`),j),onSuccess:()=>{p.invalidateQueries({queryKey:["tasks",v]})}}),f=H({mutationFn:async()=>{if(!v)throw new Error("No project selected");await A.delete("/tasks",{params:{projectId:v}})},onSuccess:()=>{p.invalidateQueries({queryKey:["tasks",v]})}});return{createMutation:C,updateMutation:K,deleteMutation:Q,clearTasksMutation:f}},nt=40,T=40;function w(p){const v=new Date(p).getTime();return Number.isFinite(v)?v:null}function dt(){const{data:p=[]}=tt(),{createMutation:v,updateMutation:C,deleteMutation:K,clearTasksMutation:Q}=st(),{show:f}=Pe(),{selectedId:j}=ce(),[N,_]=h.useState(new Set),[E,ye]=h.useState(new Set),[b,le]=h.useState(nt),[$,de]=h.useState({}),[R,G]=h.useState(null),[we,W]=h.useState(!1),[P,V]=h.useState("create-root"),[F,Z]=h.useState(null),[o,k]=h.useState({name:"",start:"",end:"",progress:0,predecessorsWbs:"",parentId:""}),ve=h.useRef(null),O=h.useRef(null),D=h.useRef(null),B=h.useRef(null),J=h.useRef(!1),U=h.useRef(null),[ue,ee]=h.useState(!1),[x,te]=h.useState(null),X=h.useRef(x);h.useEffect(()=>{X.current=x},[x]);const pe=e=>{if(!D.current)return;const s=Math.max(0,Math.min(D.current.scrollTop+e.deltaY,D.current.scrollHeight-D.current.clientHeight));D.current.scrollTop=s,O.current&&(O.current.style.transform=`translateY(-${s}px)`),e.preventDefault()},z=h.useMemo(()=>{let e;p.length===0?e=new Date().setHours(0,0,0,0):e=Math.min(...p.map(i=>w(i.start)||Date.now()));const s=new Date(e),n=s.getDay(),a=s.getDate()-n+(n===0?-6:1);return s.setDate(a),s.setHours(0,0,0,0),s.getTime()},[p]),Y=h.useMemo(()=>{if(p.length===0)return 30;const e=Math.max(...p.map(s=>w(s.end)||Date.now()));return Math.ceil((e-z)/(1e3*60*60*24))+30},[p,z]),he=(Date.now()-z)/(1e3*60*60*24)*b;h.useEffect(()=>{if(p.length>0&&N.size===0){const e=new Set(p.map(s=>s.id));_(e)}},[p,N]);const je=(e,s,n)=>{D.current&&(J.current||(J.current=!0,O.current&&(O.current.style.transform=`translateY(-${s}px)`),B.current&&n!==void 0&&Math.abs(B.current.scrollLeft-n)>1&&(B.current.scrollLeft=n),requestAnimationFrame(()=>{J.current=!1})))},be=e=>{je("gantt",e.currentTarget.scrollTop,e.currentTarget.scrollLeft)},Se=e=>{if(!D.current)return;const s=e.currentTarget.scrollLeft;Math.abs(D.current.scrollLeft-s)>1&&(D.current.scrollLeft=s)};h.useEffect(()=>{const e=()=>G(null);return window.addEventListener("click",e),()=>window.removeEventListener("click",e)},[]);const y=h.useMemo(()=>{const e=p.filter(i=>!j||!i.projectId||i.projectId===j),s=new Map;e.forEach(i=>{const l=i.parentId||void 0;s.has(l)||s.set(l,[]),s.get(l).push(i)}),s.forEach(i=>i.sort((l,r)=>(l.order||0)-(r.order||0)));const n=[],a=(i,l,r)=>{(s.get(i)||[]).forEach((u,g)=>{const d=r?`${r}.${g+1}`:`${g+1}`,m=N.has(u.id);n.push({...u,depth:l,isExpanded:m,hasChildren:s.has(u.id),wbsNumber:d,index:n.length,isVisible:!0}),m&&s.has(u.id)&&a(u.id,l+1,d)})};return a(void 0,0,""),n},[p,N,j]),se=e=>e?e.map(s=>{const n=y.find(a=>a.id===s);return n?n.wbsNumber:""}).filter(Boolean).join(", "):"",ne=e=>e?e.split(",").map(n=>n.trim()).map(n=>{const a=y.find(i=>i.wbsNumber===n);return a?a.id:void 0}).filter(n=>!!n):[],ke=e=>{const s=new Set(N);s.has(e)?s.delete(e):s.add(e),_(s)},re=e=>{const s=new Set;s.add(e),ye(s)},me=(e,s)=>{e.preventDefault(),e.stopPropagation(),re(s),G({x:e.clientX,y:e.clientY,taskId:s})};h.useEffect(()=>{const e=n=>{if(!X.current)return;n.preventDefault();const{id:a,mode:i,startX:l,originalStart:r,originalEnd:c}=X.current,u=n.clientX-l,g=Math.round(u/b);te(M=>M?{...M,currentX:n.clientX,currentY:n.clientY}:null);let d=r,m=c;i==="move"?(d=r+g*24*60*60*1e3,m=c+g*24*60*60*1e3):i==="resize"&&(m=c+g*24*60*60*1e3,m<d&&(m=d));const S=new Date(d).toISOString().slice(0,10),I=new Date(m).toISOString().slice(0,10);de(M=>({...M,[a]:{start:S,end:I}}))},s=async n=>{if(!X.current)return;const{id:a,mode:i,startX:l}=X.current,r=n.clientX-l,c=Math.round(r/b);if(de(u=>{const g={...u};return delete g[a],g}),te(null),c!==0){const u=p.find(g=>g.id===a);if(u)try{const g=w(u.start)||Date.now(),d=w(u.end)||Date.now();let m=g,S=d;i==="move"?(m=g+c*24*60*60*1e3,S=d+c*24*60*60*1e3):i==="resize"&&(S=d+c*24*60*60*1e3,S<m&&(S=m));const I={...u,start:new Date(m).toISOString().slice(0,10),end:new Date(S).toISOString().slice(0,10)};await C.mutateAsync(I),f("일정이 변경되었습니다.","success")}catch{f("일정 변경 실패","error")}}};return x&&(window.addEventListener("mousemove",e),window.addEventListener("mouseup",s)),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",s)}},[x,b,p,C,f]);const De=(e,s,n)=>{e.stopPropagation();const a=w(s.start),i=w(s.end);if(!a||!i)return;const l=e.currentTarget.getBoundingClientRect(),r=e.clientX-l.left,c=n-r<15;te({id:s.id,mode:c?"resize":"move",startX:e.clientX,currentX:e.clientX,currentY:e.clientY,originalStart:a,originalEnd:i})},ae=e=>{V("edit"),Z(e),k({name:e.name,start:String(e.start).split("T")[0],end:String(e.end).split("T")[0],progress:e.progress,predecessorsWbs:se(e.predecessors),parentId:e.parentId||""}),W(!0)},Ne=()=>{V("create-root"),Z(null),k({name:"",start:new Date().toISOString().slice(0,10),end:new Date(Date.now()+864e5).toISOString().slice(0,10),progress:0,predecessorsWbs:"",parentId:""}),W(!0)},Ie=e=>{const s=e||Array.from(E)[0];if(!s){f("상위 타스크를 먼저 선택해주세요.","warning");return}const n=p.find(a=>a.id===s);V("create-sub"),Z(null),k({name:"",start:n?String(n.start).split("T")[0]:new Date().toISOString().slice(0,10),end:n?String(n.end).split("T")[0]:new Date(Date.now()+864e5).toISOString().slice(0,10),progress:0,predecessorsWbs:"",parentId:s}),W(!0)},Me=async e=>{if(e.preventDefault(),!o.name||!o.start||!o.end){f("필수 항목을 입력하세요.","warning");return}const s=ne(o.predecessorsWbs),n={projectId:j||void 0,name:o.name,start:o.start,end:o.end,progress:Number(o.progress),predecessors:s,parentId:o.parentId||void 0,order:F?F.order:(p.length+1)*10};try{if(P==="edit"&&F)await C.mutateAsync({...F,...n}),f("타스크가 수정되었습니다.","success");else{const a=await v.mutateAsync(n);a.parentId&&_(i=>new Set(i).add(a.parentId)),f("타스크가 추가되었습니다.","success")}W(!1)}catch(a){console.error(a),f("작업 저장 실패","error")}},Ce=async e=>{if(confirm("정말 삭제하시겠습니까?"))try{await K.mutateAsync(e),f("삭제되었습니다.","success"),G(null)}catch{f("삭제 실패","error")}},Te=async e=>{if(!j){f("프로젝트를 먼저 선택해주세요.","warning"),e.target.value="";return}const s=e.target.files?.[0];if(!s)return;if(!confirm(`기존 일정을 모두 삭제하고 MS Project 파일을 가져오시겠습니까?
이 작업은 되돌릴 수 없습니다.`)){e.target.value="";return}ee(!0);try{await Q.mutateAsync()}catch(a){console.error(a),f("기존 일정 삭제 중 오류가 발생했습니다.","error"),ee(!1),e.target.value="";return}const n=new FileReader;n.onload=async a=>{const i=a.target?.result;try{const l=Ee(i,j);if(l.length===0){f("가져올 작업이 없습니다.","warning");return}let r=0;for(const c of l)try{await v.mutateAsync(c),r++}catch(u){console.error("Failed to import task",c.name,u)}f(`${r}개 작업 가져오기 완료`,"success")}catch(l){console.error(l),f("XML 파싱 또는 저장 중 오류가 발생했습니다.","error")}finally{ee(!1),U.current&&(U.current.value=""),_(new Set)}},n.readAsText(s)},Ee=(e,s)=>{const a=new DOMParser().parseFromString(e,"text/xml"),i=Array.from(a.querySelectorAll("Task")),l=new Map,r=[];i.forEach(d=>{const m=d.querySelector("UID")?.textContent;if(!m)return;const S=d.querySelector("Name")?.textContent||"Untitled";if(m==="0")return;const I=crypto.randomUUID();l.set(m,I);const M=d.querySelector("Start")?.textContent||"",oe=d.querySelector("Finish")?.textContent||"",q=parseInt(d.querySelector("OutlineLevel")?.textContent||"0"),Re=parseInt(d.querySelector("PercentComplete")?.textContent||"0"),fe=[];d.querySelectorAll("PredecessorLink > PredecessorUID").forEach(ze=>{const xe=ze.textContent;xe&&fe.push(xe)}),r.push({uuid:I,uid:m,name:S,start:M.split("T")[0],end:oe.split("T")[0],level:q,progress:Re,predUids:fe})});const c=[],u=[],g=10;return r.forEach((d,m)=>{for(;c.length>0&&c[c.length-1].level>=d.level;)c.pop();const S=c.length>0?c[c.length-1].uuid:void 0;c.push({level:d.level,uuid:d.uuid});const I=d.predUids.map(q=>l.get(q)).filter(q=>!!q),M=d.start||new Date().toISOString().slice(0,10),oe=d.end||new Date().toISOString().slice(0,10);u.push({id:d.uuid,projectId:s,name:d.name,start:M,end:oe,progress:d.progress,parentId:S,predecessors:I,order:(m+1)*g})}),u};h.useEffect(()=>{if(o.predecessorsWbs&&o.name){const e=ne(o.predecessorsWbs);if(e.length>0){const s=y.find(n=>n.id===e[e.length-1]);if(s&&s.end){const n=new Date(s.end),a=new Date(n.setDate(n.getDate()+1)),i=new Date(o.start),r=new Date(o.end).getTime()-i.getTime(),c=new Date(a.getTime()+(r>0?r:864e5));k(u=>({...u,start:a.toISOString().slice(0,10),end:c.toISOString().slice(0,10)}))}}}},[o.predecessorsWbs]);const ie=e=>{const s=w(e.start),n=w(e.end);if(!s||!n)return null;const a=(s-z)/(1e3*60*60*24)*b,l=(Math.ceil((n-s)/(1e3*60*60*24))+1)*b;return{left:a,width:l}},$e=()=>y.map(e=>{if(!e.predecessors||e.predecessors.length===0)return null;const s=y.find(l=>l.id===e.id);if(!s)return null;const n=ie(s);if(!n)return null;const a=s.index*T+T/2,i=n.left;return e.predecessors.map(l=>{const r=y.find(m=>m.id===l);if(!r)return null;const c=ie(r);if(!c)return null;const u=r.index*T+T/2,g=c.left+c.width,d=`M ${g} ${u} L ${g+10} ${u} L ${g+10} ${a} L ${i} ${a}`;return t.jsx("path",{d,stroke:"#64748b",strokeWidth:"1.5",fill:"none",markerEnd:"url(#arrowhead)"},`${e.id}-${l}`)})}),ge=[];for(let e=0;e<Y;e++){const s=e%7===0;ge.push(t.jsx("div",{style:{position:"absolute",left:e*b,top:0,bottom:0,borderRight:"1px dashed #334155",background:s?"rgba(255,255,255,0.02)":"transparent",width:b,pointerEvents:"none"}},e))}return t.jsxs("div",{className:"page",style:{position:"relative"},children:[t.jsxs("header",{className:"section-header",style:{alignItems:"flex-end"},children:[t.jsxs("div",{children:[t.jsx("p",{className:"eyebrow",children:"공정(WBS)·일정"}),t.jsx("h2",{children:"WBS & Gantt Chart"}),t.jsx("p",{className:"muted",children:"좌측 트리와 우측 차트가 연동되는 커스텀 간트 차트입니다."})]}),t.jsxs("div",{style:{display:"flex",gap:"0.5rem",paddingBottom:"0.2rem"},children:[t.jsxs("div",{style:{display:"flex",gap:"0.25rem",background:"rgba(255, 255, 255, 0.05)",padding:"4px",borderRadius:"8px",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[t.jsx("button",{className:"icon-btn",title:"축소",onClick:()=>le(e=>Math.max(10,e-5)),children:t.jsx(et,{size:16})}),t.jsx("button",{className:"icon-btn",title:"확대",onClick:()=>le(e=>Math.min(100,e+5)),children:t.jsx(Ze,{size:16})})]}),t.jsx("input",{type:"file",ref:U,onChange:Te,accept:".xml",hidden:!0}),t.jsxs("button",{className:"pill pill-outline",onClick:()=>U.current?.click(),disabled:ue,children:[t.jsx(Ge,{size:14,style:{marginRight:4}})," ",ue?"가져오는 중...":"XML 가져오기"]}),t.jsxs("button",{className:"pill pill-outline",onClick:Ne,children:[t.jsx(Xe,{size:14,style:{marginRight:4}})," 새 작업 추가"]})]})]}),t.jsxs("div",{className:"gantt-container",children:[t.jsxs("div",{className:"gantt-wbs-pane",children:[t.jsxs("div",{className:"wbs-header",children:[t.jsx("div",{style:{width:80},children:"NO"}),t.jsx("div",{children:"WBS Name"})]}),t.jsx("div",{className:"wbs-content",ref:ve,onWheelCapture:pe,style:{overflow:"hidden"},children:t.jsxs("div",{ref:O,children:[y.map(e=>{const s=E.has(e.id);return t.jsxs("div",{className:`wbs-row ${s?"row-active":""}`,onClick:()=>re(e.id),onDoubleClick:()=>ae(e),onContextMenu:n=>me(n,e.id),style:{cursor:"pointer",background:s?"rgba(139, 211, 255, 0.1)":void 0},children:[t.jsx("div",{className:"wbs-cell-id",style:{width:80,paddingLeft:10,textAlign:"left",color:"#8bd3ff",fontSize:"0.85rem"},children:e.wbsNumber}),t.jsxs("div",{className:"wbs-cell-name",style:{paddingLeft:e.depth*15},children:[e.hasChildren?t.jsx("button",{className:"icon-btn",onClick:n=>{n.stopPropagation(),ke(e.id)},children:e.isExpanded?t.jsx(Be,{size:14}):t.jsx(Ye,{size:14})}):t.jsx("span",{style:{width:14,display:"inline-block"}}),e.name]})]},e.id)}),t.jsx("div",{style:{height:y.length===0?200:0}})]})})]}),t.jsxs("div",{className:"gantt-chart-pane",children:[t.jsx("div",{className:"timeline-header",ref:B,onScroll:Se,children:t.jsx("div",{style:{position:"relative",height:"100%",width:Y*b},children:Array.from({length:Math.ceil(Y/7)}).map((e,s)=>t.jsxs("div",{className:"timeline-scale-cell",style:{left:s*7*b,width:7*b},children:[new Date(z+s*7*1e3*60*60*24).getMonth()+1,"/",new Date(z+s*7*1e3*60*60*24).getDate()," (W",s+1,")"]},s))})}),t.jsx("div",{className:"gantt-body",ref:D,onScroll:be,onWheelCapture:pe,children:t.jsxs("div",{style:{position:"relative",height:y.length*T,width:Y*b},children:[ge,he>=0&&t.jsx("div",{className:"today-line",style:{left:he}}),t.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1},children:[t.jsx("defs",{children:t.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:t.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#64748b"})})}),$e()]}),y.map((e,s)=>t.jsx("div",{className:`gantt-row-bg ${E.has(e.id)?"row-active":""}`,style:{top:s*T,width:"100%",background:E.has(e.id)?"rgba(139, 211, 255, 0.05)":void 0}},e.id)),y.map((e,s)=>{const a=$[e.id]?{...e,...$[e.id]}:e,i=ie(a);if(!i)return null;const l=w(a.start),r=w(a.end),c=l&&r?Math.ceil((r-l)/(1e3*60*60*24))+1:0;return t.jsxs("div",{className:"gantt-bar-item",onDoubleClick:()=>ae(e),onClick:()=>re(e.id),onContextMenu:u=>me(u,e.id),onMouseDown:u=>De(u,e,i.width),style:{top:s*T+8,left:i.left,width:i.width,background:e.hasChildren?"#334155":void 0,border:e.hasChildren?"1px solid #475569":void 0,cursor:e.hasChildren?"default":"ew-resize",paddingRight:10},children:[t.jsxs("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",pointerEvents:"none",display:"block",width:"100%"},children:[e.name," (",c,"일)"]}),!e.hasChildren&&t.jsx("div",{className:"gantt-resize-handle",style:{position:"absolute",right:0,top:0,bottom:0,width:10,cursor:"col-resize",zIndex:2}})]},e.id)})]})})]})]}),x&&t.jsx("div",{style:{position:"fixed",top:x.currentY-40,left:x.currentX+10,background:"rgba(0,0,0,0.85)",color:"#fff",padding:"6px 10px",borderRadius:6,fontSize:"0.8rem",zIndex:1e4,pointerEvents:"none",boxShadow:"0 4px 6px rgba(0,0,0,0.3)",whiteSpace:"nowrap"},children:t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("span",{style:{fontWeight:600,color:"#8bd3ff"},children:x.mode==="move"?"이동":"기간 조정"}),t.jsxs("span",{children:[$[x.id]?.start||new Date(x.originalStart).toISOString().slice(0,10)," ~ ",$[x.id]?.end||new Date(x.originalEnd).toISOString().slice(0,10)]}),t.jsxs("span",{style:{color:"#cbd5e1",opacity:.8},children:["(",Math.ceil((new Date($[x.id]?.end||x.originalEnd).getTime()-new Date($[x.id]?.start||x.originalStart).getTime())/(1e3*60*60*24))+1,"일)"]})]})}),R&&t.jsxs("div",{className:"context-menu",style:{top:R.y,left:R.x},children:[t.jsxs("div",{className:"context-menu-item",onClick:()=>Ie(R.taskId),children:[t.jsx(Ke,{size:14})," 하위 타스크 추가"]}),t.jsxs("div",{className:"context-menu-item",onClick:()=>{const e=y.find(s=>s.id===R.taskId);e&&ae(e)},children:[t.jsx(Ae,{size:14})," 상세보기"]}),t.jsxs("div",{className:"context-menu-item",style:{color:"#ff6f6f"},onClick:()=>Ce(R.taskId),children:[t.jsx(qe,{size:14})," 삭제"]})]}),we&&t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal-content",children:[t.jsx("h3",{children:P==="create-root"?"새 작업 (최상위)":P==="create-sub"?"하위 작업 추가":"작업 상세 정보"}),t.jsxs("form",{onSubmit:Me,children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"작업명"}),t.jsx("input",{type:"text",value:o.name,onChange:e=>k({...o,name:e.target.value}),autoFocus:!0})]}),t.jsxs("div",{className:"form-group",children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[t.jsx("label",{style:{margin:0},children:"기간 (일수)"}),t.jsx("span",{className:"badge",style:{background:"#6366f1",color:"white",padding:"2px 8px",borderRadius:4,fontSize:"0.75rem",fontWeight:600},children:o.start&&o.end?`${Math.ceil((new Date(o.end).getTime()-new Date(o.start).getTime())/(1e3*60*60*24))+1}일간`:"0일간"})]}),t.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsx("label",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:"시작일"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[t.jsx("input",{type:"date",value:o.start,onChange:e=>k({...o,start:e.target.value}),style:{colorScheme:"dark"}}),t.jsxs("span",{style:{fontSize:"0.8rem",color:"#64748b"},children:["(",o.start?new Date(o.start).toLocaleDateString("ko-KR",{weekday:"short"}):"",")"]})]})]}),t.jsxs("div",{style:{flex:1},children:[t.jsx("label",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:"종료일"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[t.jsx("input",{type:"date",value:o.end,onChange:e=>k({...o,end:e.target.value}),style:{colorScheme:"dark"}}),t.jsxs("span",{style:{fontSize:"0.8rem",color:"#64748b"},children:["(",o.end?new Date(o.end).toLocaleDateString("ko-KR",{weekday:"short"}):"",")"]})]})]})]})]}),t.jsxs("div",{className:"form-group",children:[t.jsxs("label",{children:["진척률 (",o.progress,"%)"]}),t.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[t.jsx("input",{type:"range",min:"0",max:"100",value:o.progress,onChange:e=>k({...o,progress:Number(e.target.value)}),style:{flex:1,accentColor:"#6366f1"}}),t.jsx("input",{type:"number",min:"0",max:"100",value:o.progress,onChange:e=>k({...o,progress:Math.max(0,Math.min(100,Number(e.target.value)))}),style:{width:60,textAlign:"center",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"white"}})]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"선행 작업 (WBS 번호)"}),t.jsx("input",{type:"text",placeholder:"예: 1.1, 1.2 (쉼표로 구분)",value:o.predecessorsWbs,onChange:e=>k({...o,predecessorsWbs:e.target.value})}),o.predecessorsWbs&&t.jsx("div",{className:"predecessor-preview",children:ne(o.predecessorsWbs).map(e=>{const s=y.find(n=>n.id===e);return s?t.jsxs("div",{className:"pred-tag",children:[t.jsx("span",{className:"pred-wbs",children:s.wbsNumber}),t.jsx("span",{className:"pred-name",children:s.name}),t.jsxs("span",{className:"pred-date",children:[w(s.end)?new Date(w(s.end)).toLocaleDateString():""," 종료"]})]},e):null})})]}),P!=="create-root"&&t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"상위 작업 정보"}),t.jsx("div",{style:{padding:"8px 12px",background:"rgba(255,255,255,0.05)",borderRadius:4,fontSize:"0.9rem",color:"#cbd5e1"},children:P==="create-sub"?(()=>{const e=y.find(s=>s.id===o.parentId);return e?`상위 작업: ${e.name} (${e.wbsNumber})`:"선택된 상위 작업 없음"})():(()=>{const e=y.find(s=>s.id===o.parentId);return e?`상위 작업: ${e.name} (${e.wbsNumber})`:"최상위 작업 (Root)"})()})]}),t.jsxs("div",{className:"form-actions",style:{marginTop:"1.5rem",gap:"0.75rem",borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:"1rem",justifyContent:"flex-end",display:"flex"},children:[t.jsx("button",{type:"button",className:"pill pill-outline",onClick:()=>W(!1),children:"취소"}),t.jsxs("button",{type:"submit",className:"pill",style:{background:"#6366f1",borderColor:"#6366f1",paddingLeft:20,paddingRight:20},children:[t.jsx(_e,{size:16}),t.jsx("span",{style:{fontWeight:600},children:"저장"})]})]})]})]})}),t.jsxs("div",{className:"card",style:{marginTop:"1rem"},children:[t.jsx("p",{className:"card-label",children:"선택작업"}),E.size===0?t.jsx("p",{className:"muted",children:"왼쪽 WBS에서 작업을 선택하면 상세 정보가 나타납니다."}):(()=>{const e=Array.from(E)[0],s=y.find(r=>r.id===e);if(!s)return t.jsx("p",{className:"muted",children:"선택된 작업 정보를 불러올 수 없습니다."});const n=`레벨 ${s.depth+1}`,a=s.predecessors?.length?se(s.predecessors):"-",i=(()=>{const r=w(s.start),c=w(s.end);return!r||!c?"-":`${Math.ceil((c-r)/(1e3*60*60*24))+1}일`})(),l=y.filter(r=>r.id!==s.id&&r.wbsNumber.startsWith(`${s.wbsNumber}.`));return t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr 260px 120px 120px 1fr",gap:"0.75rem",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"WBS"}),t.jsx("div",{children:s.wbsNumber})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"작업명"}),t.jsx("div",{children:s.name})]}),t.jsxs("div",{style:{whiteSpace:"nowrap"},children:[t.jsx("strong",{children:i==="-"?"작업기간":`작업기간(${i})`}),t.jsx("div",{children:s.start&&s.end?`${String(s.start).slice(0,10)} ~ ${String(s.end).slice(0,10)}`:"-"})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"진척율"}),t.jsxs("div",{children:[s.progress,"%"]})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"레벨"}),t.jsx("div",{children:n})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"선행작업"}),t.jsx("div",{children:a})]}),l.length>0&&t.jsxs("div",{style:{gridColumn:"1 / -1",marginTop:"0.25rem"},children:[t.jsx("strong",{children:"하위 작업"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr 260px 120px 120px 1fr",gap:"0.5rem",marginTop:"0.5rem",alignItems:"center"},children:l.map(r=>{const c=(()=>{const d=w(r.start),m=w(r.end);return!d||!m?"-":`${Math.ceil((m-d)/864e5)+1}일`})(),u=r.predecessors?.length?se(r.predecessors):"-",g=r.start&&r.end;return t.jsxs(Oe.Fragment,{children:[t.jsx("div",{style:{color:"#8bd3ff"},children:r.wbsNumber}),t.jsx("div",{children:r.name}),t.jsx("div",{style:{whiteSpace:"nowrap"},children:t.jsx("div",{children:g?`${String(r.start).slice(0,10)} ~ ${String(r.end).slice(0,10)}${c!=="-"?` (${c})`:""}`:"-"})}),t.jsxs("div",{children:[r.progress??0,"%"]}),t.jsx("div",{children:`레벨 ${r.depth+1}`}),t.jsx("div",{children:u})]},r.id)})})]})]})})()]})]})}export{dt as default};

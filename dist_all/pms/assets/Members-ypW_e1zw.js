import{d as _,a as W,b as J,r as t,j as e}from"./index-CV60rgYO.js";import{a as p}from"./mock-8k32bwyI.js";import{u as q,a as X,b as G}from"./useProjectMembers-BFlYhwrt.js";import{P as S,T as f}from"./trash-2-CoTpdRSx.js";import{C as H}from"./circle-check-big-CyzcpP_a.js";import{c as T}from"./createLucideIcon-xPnhNdih.js";import{E as K}from"./eye-D1GrXV4S.js";import"./useMutation-HjsCWOAi.js";const Q=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],V=T("circle-x",Q);const Y=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Z=T("rotate-ccw",Y),g=[{code:"executive",label:"경영자"},{code:"manager",label:"관리자"},{code:"field",label:"현장근무"},{code:"sysadmin",label:"시스템관리자"}];function ie(){const{user:y}=_(),{selectedId:l}=W(),{data:E,isLoading:P,isError:I}=q(y?.uid??""),i=X(),d=G(),{show:r}=J(),[j,R]=t.useState(""),[N,z]=t.useState("field"),[u,v]=t.useState(l||"");t.useEffect(()=>{l&&v(l)},[l]),t.useEffect(()=>{i.isSuccess&&r("역할이 변경되었습니다.","success"),d.isSuccess&&r("멤버가 삭제되었습니다.","success")},[i.isSuccess,d.isSuccess,r]);const A=E??[],[n,x]=t.useState("users"),[C,U]=t.useState([]),h=async()=>{try{const s=await fetch("http://localhost:3000/api/users");s.ok&&U(await s.json())}catch(s){console.error(s)}},[w,D]=t.useState([]),b=async()=>{try{const s=await fetch("http://localhost:3000/api/resources");s.ok&&D(await s.json())}catch(s){console.error(s)}},[c,o]=t.useState({type:"장비",name:"",projectId:l||"p1"});t.useEffect(()=>{l&&o(s=>({...s,projectId:l}))},[l]),t.useEffect(()=>{h(),b()},[]);const $=async s=>{try{(await fetch("http://localhost:3000/api/users/approve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:s})})).ok?(r("사용자가 승인되었습니다. (고유코드 생성 완료)","success"),h()):r("승인 실패","error")}catch(a){console.error(a),r("승인 중 오류 발생","error")}},B=async(s,a)=>{try{(await fetch("http://localhost:3000/api/users/approve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:s,role:a})})).ok&&(r("권한이 변경되었습니다.","success"),h())}catch(m){console.error(m)}},k=async s=>{if(window.confirm("정말 이 사용자를 삭제하시겠습니까?"))try{await fetch(`http://localhost:3000/api/users/${s}`,{method:"DELETE"}),r("사용자가 삭제되었습니다.","success"),h()}catch(a){console.error(a)}},F=async s=>{if(window.confirm("정말 이 자원을 삭제하시겠습니까?"))try{await fetch(`http://localhost:3000/api/resources/${s}`,{method:"DELETE"}),r("자원이 삭제되었습니다.","success"),b()}catch(a){console.error(a)}},M=async s=>{if(s.preventDefault(),!j||!u){r("사용자와 프로젝트를 선택하세요.","warning");return}try{await i.mutateAsync({uid:j,projectId:u,roleCode:N})}catch(a){console.error(a),r("역할 설정 실패: 권한/네트워크 확인.","error")}},O=async s=>{if(s.preventDefault(),!c.name){r("자원명을 입력해주세요.","warning");return}try{(await fetch("http://localhost:3000/api/resources",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:crypto.randomUUID(),type:c.type,name:c.name,projectId:c.projectId})})).ok&&(r(`[시스템] ${c.name} 자원이 등록되었습니다.`,"success"),o(m=>({...m,name:""})),b())}catch(a){console.error(a)}},L=s=>{if(!s)return"-";const a=s.replace(/[^0-9]/g,"");return a.length>7?`${a.slice(0,3)}-${a.slice(3,7)}-${a.slice(7)}`:a};return e.jsxs("div",{className:"page",children:[e.jsxs("header",{className:"section-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"eyebrow",children:"시스템관리"}),e.jsx("h2",{children:"통합 관리 시스템"}),e.jsx("p",{className:"muted",children:"직원 및 자원(장비/인력)을 통합 관리합니다."})]}),e.jsx("div",{className:"pill pill-outline",children:"System Admin"})]}),e.jsxs("div",{className:"tabs",style:{display:"flex",gap:"1rem",marginBottom:"1.5rem",borderBottom:"1px solid #e2e8f0"},children:[e.jsx("button",{onClick:()=>x("users"),style:{padding:"0.75rem 1rem",background:"none",border:"none",borderBottom:n==="users"?"2px solid #3b82f6":"2px solid transparent",color:n==="users"?"#3b82f6":"#64748b",fontWeight:n==="users"?600:400,cursor:"pointer"},children:"직원 권한 관리"}),e.jsx("button",{onClick:()=>x("resources"),style:{padding:"0.75rem 1rem",background:"none",border:"none",borderBottom:n==="resources"?"2px solid #3b82f6":"2px solid transparent",color:n==="resources"?"#3b82f6":"#64748b",fontWeight:n==="resources"?600:400,cursor:"pointer"},children:"자원(장비/인력) 관리"}),e.jsx("button",{onClick:()=>x("my-role"),style:{padding:"0.75rem 1rem",background:"none",border:"none",borderBottom:n==="my-role"?"2px solid #3b82f6":"2px solid transparent",color:n==="my-role"?"#3b82f6":"#64748b",fontWeight:n==="my-role"?600:400,cursor:"pointer"},children:"내 프로젝트 역할"})]}),n==="users"&&e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"card",children:[e.jsx("p",{className:"card-label",children:"프로젝트 멤버 역할 지정"}),e.jsxs("form",{className:"form-grid",onSubmit:M,children:[e.jsxs("label",{children:[e.jsx("span",{children:"대상 직원"}),e.jsxs("select",{className:"input-std",value:j,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"",children:"직원을 선택하세요"}),C.filter(s=>s.status==="approved").map(s=>e.jsxs("option",{value:s.uid,children:[s.name," (",s.email,")"]},s.uid))]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"프로젝트"}),e.jsxs("select",{className:"input-std",value:u,onChange:s=>v(s.target.value),children:[e.jsx("option",{value:"",children:"프로젝트를 선택하세요"}),p.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"역할"}),e.jsx("select",{className:"input-std",value:N,onChange:s=>z(s.target.value),children:g.map(s=>e.jsx("option",{value:s.code,children:s.label},s.code))})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"icon-button",disabled:i.isPending,"aria-label":"역할 설정",children:i.isPending?"…":e.jsx(S,{size:18})})})]}),e.jsx("p",{className:"muted",children:"등록된 직원 목록에서 선택하여 프로젝트 역할을 부여합니다."})]}),e.jsxs("section",{className:"card table-card",style:{marginTop:"1.5rem"},children:[e.jsx("div",{className:"table-head",children:e.jsx("p",{className:"card-label",children:"직원관리"})}),e.jsxs("div",{className:"table",children:[e.jsxs("div",{className:"table-row table-header",style:{gridTemplateColumns:"0.8fr 1.2fr 1fr 0.8fr 1fr 0.8fr 0.6fr 1fr"},children:[e.jsx("span",{children:"이름"}),e.jsx("span",{children:"이메일"}),e.jsx("span",{children:"전화번호"}),e.jsx("span",{children:"지점"}),e.jsx("span",{children:"직원구분"}),e.jsx("span",{children:"고유코드"}),e.jsx("span",{children:"상태"}),e.jsx("span",{children:"관리"})]}),C.map(s=>e.jsxs("div",{className:"table-row",style:{gridTemplateColumns:"0.8fr 1.2fr 1fr 0.8fr 1fr 0.8fr 0.6fr 1fr",alignItems:"center"},children:[e.jsx("span",{children:s.name}),e.jsx("span",{children:s.email}),e.jsx("span",{children:L(s.contact)}),e.jsx("span",{children:s.branch||"본사"}),e.jsx("span",{children:e.jsx("select",{className:"input-std",value:s.role,onChange:a=>B(s.uid,a.target.value),children:g.map(a=>e.jsx("option",{value:a.code,children:a.label},a.code))})}),e.jsx("span",{style:{color:"#8bd3ff"},children:s.code||"-"}),e.jsx("span",{children:s.status==="pending"?e.jsx("span",{className:"badge badge-alert",children:"대기중"}):e.jsx("span",{className:"badge badge-live",children:"승인됨"})}),e.jsx("span",{className:"row-actions",style:{gap:"0.5rem"},children:s.status==="pending"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"icon-button",title:"승인",onClick:()=>$(s.uid),style:{color:"#5eead4",borderColor:"#5eead4"},children:e.jsx(H,{size:18})}),e.jsx("button",{className:"icon-button",title:"거절/삭제",onClick:()=>k(s.uid),style:{color:"#fca5a5",borderColor:"#fca5a5"},children:e.jsx(V,{size:18})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"icon-button",title:"상세보기",onClick:()=>r("상세보기 기능 준비중","info"),children:e.jsx(K,{size:16})}),e.jsx("button",{className:"icon-button",title:"비밀번호 초기화",onClick:()=>r("비밀번호 초기화 메일 전송 (준비중)","info"),children:e.jsx(Z,{size:16})}),e.jsx("button",{className:"icon-button",onClick:()=>k(s.uid),title:"삭제",children:e.jsx(f,{size:16})})]})})]},s.uid))]})]})]}),n==="resources"&&e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"card",children:[e.jsx("p",{className:"card-label",children:"신규 자원 등록(마스터)"}),e.jsxs("form",{className:"form-grid",onSubmit:O,children:[e.jsxs("label",{children:[e.jsx("span",{children:"유형"}),e.jsxs("select",{className:"input-std",value:c.type,onChange:s=>o({...c,type:s.target.value}),children:[e.jsx("option",{value:"장비",children:"장비"}),e.jsx("option",{value:"인력",children:"인력"})]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"자원명"}),e.jsx("input",{className:"input-std",value:c.name,onChange:s=>o({...c,name:s.target.value}),placeholder:"예: 포크레인 1호기"})]}),e.jsxs("label",{children:[e.jsx("span",{children:"소속 프로젝트"}),e.jsx("select",{className:"input-std",value:c.projectId,onChange:s=>o({...c,projectId:s.target.value}),children:p.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"icon-button","aria-label":"자원 추가",children:e.jsx(S,{size:18})})})]}),e.jsx("p",{className:"muted",children:"등록된 자원은 '자원' 메뉴에서 작업에 배정할 수 있습니다."})]}),e.jsxs("section",{className:"card table-card",style:{marginTop:"1.5rem"},children:[e.jsx("div",{className:"table-head",children:e.jsx("p",{className:"card-label",children:"보유 자원 목록"})}),e.jsxs("div",{className:"table",children:[e.jsxs("div",{className:"table-row table-header",children:[e.jsx("span",{children:"유형"}),e.jsx("span",{children:"자원명"}),e.jsx("span",{children:"소속"}),e.jsx("span",{children:"관리"})]}),w.length===0?e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#94a3b8"},children:"등록된 자원이 없습니다."}):w.map(s=>e.jsxs("div",{className:"table-row",children:[e.jsx("span",{children:s.type}),e.jsx("span",{style:{fontWeight:500},children:s.name}),e.jsx("span",{children:p.find(a=>a.id===s.project_id)?.name||"공통"}),e.jsx("span",{className:"row-actions",children:e.jsx("button",{className:"icon-button",onClick:()=>F(s.id),title:"삭제",children:e.jsx(f,{size:18})})})]},s.id))]})]})]}),n==="my-role"&&e.jsxs("section",{className:"card table-card",children:[e.jsx("div",{className:"table-head",children:e.jsx("p",{className:"card-label",children:"내 역할(참여 프로젝트)"})}),P&&e.jsx("p",{className:"muted",children:"불러오는 중..."}),I&&e.jsx("p",{className:"muted",children:"불러오기 오류: 권한/네트워크 확인."}),e.jsxs("div",{className:"table",children:[e.jsxs("div",{className:"table-row table-header",children:[e.jsx("span",{children:"프로젝트"}),e.jsx("span",{children:"역할"}),e.jsx("span",{children:"관리"})]}),A.map(s=>e.jsxs("div",{className:"table-row",children:[e.jsx("span",{children:p.find(a=>a.id===s.id)?.name??s.id}),e.jsx("span",{children:g.find(a=>a.code===s.roleCode)?.label??s.roleCode}),e.jsx("span",{className:"row-actions",children:e.jsx("button",{className:"icon-button",onClick:()=>d.mutate({uid:y?.uid??"",projectId:s.id}),disabled:d.isPending,"aria-label":"삭제",title:"삭제",children:e.jsx(f,{size:18})})})]},s.id))]})]})]})}export{ie as default};

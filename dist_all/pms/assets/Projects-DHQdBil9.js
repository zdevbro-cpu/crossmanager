import{r as j,a as $,b as k,c as F,j as e}from"./index-Bk_PkX1w.js";import{a as O}from"./mock-_uwThhGs.js";import{a as w}from"./validation-CKRFn1w2.js";import{T as I,P as A}from"./trash-2-1f4s6_-J.js";import{C as G}from"./circle-check-big-Craoi1vu.js";import"./createLucideIcon-CQVuD4m9.js";function q(){const[d,p]=j.useState([]),[r,m]=j.useState(!0),[c,l]=j.useState(!1);return j.useEffect(()=>{(async()=>{try{const u=await fetch("http://localhost:3000/api/personnel/pm-list");if(!u.ok)throw new Error("Failed to fetch");const b=await u.json();p(b),l(!1)}catch(u){console.error("Error fetching personnel:",u),l(!0),p([{id:"p3",name:"이PM",role:"PM"},{id:"p4",name:"최PM",role:"PM"},{id:"p5",name:"정PM",role:"PM"}])}finally{m(!1)}})()},[]),{personnel:d,isLoading:r,isError:c}}const v=[{code:"DC",label:"해체/철거"},{code:"CN",label:"신축"},{code:"RF",label:"리모델"}],f=[{code:"SS",label:"삼성"},{code:"LG",label:"LG"},{code:"SK",label:"SK"},{code:"HD",label:"현대"},{code:"ETC",label:"기타"}];function B(){return new Date().getFullYear().toString().slice(-2)}function K(d,p){const r=p.map(c=>c.code).filter(c=>c.startsWith(d)).map(c=>{const l=c.split("-"),x=l[4]??l[3],u=Number(x);return Number.isFinite(u)?u:0});return((r.length?Math.max(...r):0)+1).toString().padStart(3,"0")}function W(){const{selectedId:d,setSelectedId:p}=$(),{show:r}=k(),[m,c]=j.useState(O),{data:l,isLoading:x,isError:u}=F(),{personnel:b,isLoading:P}=q(),[h,y]=j.useState(!1),[s,o]=j.useState({code:"",name:"",client:"",address:"",constructionTypeCode:v[0].code,clientCode:f[0].code,pm:"",startDate:"",endDate:"",securityLevel:"A",regulation:"삼성",status:"준비"}),C=t=>{p(t.id),y(!1),o({code:t.code||"",name:t.name||"",client:t.client||"",address:t.address||"",constructionTypeCode:v[0].code,clientCode:f[0].code,pm:t.pm||"",startDate:typeof t.startDate=="string"?t.startDate.substring(0,10):t.startDate instanceof Date?t.startDate.toISOString().substring(0,10):"",endDate:typeof t.endDate=="string"?t.endDate.substring(0,10):t.endDate instanceof Date?t.endDate.toISOString().substring(0,10):"",securityLevel:t.securityLevel||"A",regulation:t.regulation||"삼성",status:t.status||"준비"})};j.useEffect(()=>{if(l&&l.length>0){c(l);const t=d?l.find(n=>n.id===d):l[0];t&&!s.name&&!h&&C(t)}else l&&c(l)},[l]);const N=j.useMemo(()=>{const t=`PRJ-${B()}-${s.constructionTypeCode}-${s.clientCode}`,n=K(t,m);return`${t}-${n}`},[s.constructionTypeCode,s.clientCode,m]),L=()=>{y(!0),p(""),o({code:"",name:"",client:"",address:"",constructionTypeCode:v[0].code,clientCode:f[0].code,pm:"",startDate:"",endDate:"",securityLevel:"A",regulation:"삼성",status:"준비"})},_=async t=>{if(t.preventDefault(),!s.name){r("명칭은 필수입니다.","warning");return}const n=w(s.startDate,s.endDate);if(n){r(n,"warning");return}try{const i=await fetch("http://localhost:3000/api/projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:N,name:s.name,client:s.client||"미정",address:s.address||"-",start_date:s.startDate||null,end_date:s.endDate||null,security_level:s.securityLevel,pm_name:s.pm||"-",regulation_type:s.regulation,status:s.status})});if(!i.ok)throw new Error("Failed to create project");const a=await i.json(),g={id:a.id,code:a.code,name:a.name,client:a.client,address:a.address,startDate:a.start_date||"-",endDate:a.end_date||"-",securityLevel:a.security_level,pm:a.pm_name,regulation:a.regulation_type,status:a.status};c(D=>[g,...D]),y(!1),r("프로젝트가 생성되었습니다.","success")}catch(i){console.error("Error creating project:",i),r("프로젝트 생성에 실패했습니다.","error")}},E=async t=>{if(t.preventDefault(),!d)return;if(!s.code||!s.name){r("코드와 명칭은 필수입니다.","warning");return}const n=w(s.startDate,s.endDate);if(n){r(n,"warning");return}if(confirm("변경된 내용을 저장하시겠습니까?"))try{const i=await fetch(`http://localhost:3000/api/projects/${d}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:s.code,name:s.name,client:s.client||"미정",address:s.address||"-",start_date:s.startDate||null,end_date:s.endDate||null,security_level:s.securityLevel,pm_name:s.pm||"-",regulation_type:s.regulation,status:s.status})});if(!i.ok)throw new Error("Failed to update project");const a=await i.json(),g={id:a.id,code:a.code,name:a.name,client:a.client,address:a.address,startDate:a.start_date||"-",endDate:a.end_date||"-",securityLevel:a.security_level,pm:a.pm_name,regulation:a.regulation_type,status:a.status};c(D=>D.map(S=>S.id===d?g:S)),C(g),r("프로젝트가 수정되었습니다.","success")}catch(i){console.error("Error updating project:",i),r("프로젝트 수정에 실패했습니다.","error")}},T=async t=>{confirm("삭제하시겠습니까?")&&(c(n=>n.filter(i=>i.id!==t)),r("삭제되었습니다. (DB 삭제를 위해 백엔드 구현 필요)","success"))},M=t=>{const n=m.find(i=>i.id===t);n&&(C(n),r(`프로젝트가 선택되었습니다: ${n.name}`,"info"))};return e.jsxs("div",{className:"page",children:[e.jsxs("header",{className:"section-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"eyebrow",children:"프로젝트 기본정보"}),e.jsx("h2",{children:"코드 · 명칭 · 발주처 · 기간 · 보안등급 · PM · 고객사 규정"}),e.jsx("p",{className:"muted",children:"고객사 규정(삼성/LG) 필드까지 포함해 프로젝트별 메타데이터를 분리합니다."})]}),e.jsx("div",{className:"pill pill-outline",children:"프로젝트 생성/수정/멤버 할당"})]}),e.jsxs("section",{className:"card table-card",children:[e.jsxs("div",{className:"table-head",children:[e.jsx("p",{className:"card-label",children:"프로젝트 목록"}),e.jsx("div",{className:"table-actions",children:e.jsx("button",{className:"pill pill-outline",onClick:L,children:"프로젝트 생성"})})]}),x&&e.jsx("p",{className:"muted",children:"불러오는 중..."}),u&&e.jsx("p",{className:"muted",children:"불러오기 오류, 새로고침 해주세요."}),e.jsxs("div",{className:"table projects-table",children:[e.jsxs("div",{className:"table-row table-header",children:[e.jsx("span",{children:"코드/상태"}),e.jsx("span",{children:"명칭"}),e.jsx("span",{children:"발주처"}),e.jsx("span",{children:"기간"}),e.jsx("span",{children:"보안"}),e.jsx("span",{children:"PM"}),e.jsx("span",{children:"규정"}),e.jsx("span",{children:"관리"})]}),m.map(t=>e.jsxs("div",{className:`table-row ${d===t.id?"row-active":""}`,onClick:()=>M(t.id),style:{cursor:"pointer"},children:[e.jsxs("span",{className:"code-cell",children:[e.jsx("strong",{children:t.code}),e.jsx("span",{className:`badge ${t.status==="진행"?"badge-live":""}`,children:t.status})]}),e.jsx("span",{children:t.name}),e.jsx("span",{children:t.client}),e.jsxs("span",{style:{textAlign:"center"},children:[String(t.startDate).substring(0,10)," ~ ",String(t.endDate).substring(0,10)]}),e.jsx("span",{children:t.securityLevel}),e.jsx("span",{children:t.pm}),e.jsx("span",{children:t.regulation}),e.jsx("span",{className:"row-actions",children:e.jsx("button",{className:"icon-button",onClick:n=>{n.stopPropagation(),T(t.id)},"aria-label":"삭제",title:"삭제",children:e.jsx(I,{size:18})})})]},t.id))]})]}),(h||d)&&e.jsxs("section",{className:"card",children:[e.jsxs("div",{className:"table-head",children:[e.jsx("p",{className:"card-label",children:h?"프로젝트 생성":"프로젝트 상세"}),e.jsx("button",{type:"submit",form:"project-form",className:"icon-button","aria-label":h?"추가":"저장",children:h?e.jsx(A,{size:18}):e.jsx(G,{size:18})})]}),e.jsxs("form",{id:"project-form",className:"form-grid",onSubmit:h?_:E,children:[e.jsxs("label",{children:[e.jsx("span",{children:"코드(자동생성)"}),e.jsx("input",{value:h?N:s.code,readOnly:!0})]}),e.jsxs("label",{children:[e.jsx("span",{children:"명칭*"}),e.jsx("input",{value:s.name,onChange:t=>o({...s,name:t.target.value})})]}),h&&e.jsxs("label",{children:[e.jsx("span",{children:"공사 종류"}),e.jsx("select",{value:s.constructionTypeCode,onChange:t=>o({...s,constructionTypeCode:t.target.value}),children:v.map(t=>e.jsxs("option",{value:t.code,children:[t.label," (",t.code,")"]},t.code))})]}),e.jsxs("label",{children:[e.jsx("span",{children:"발주처"}),e.jsx("input",{value:s.client,onChange:t=>o({...s,client:t.target.value})})]}),h&&e.jsxs("label",{children:[e.jsx("span",{children:"발주처 코드"}),e.jsx("select",{value:s.clientCode,onChange:t=>o({...s,clientCode:t.target.value}),children:f.map(t=>e.jsxs("option",{value:t.code,children:[t.label," (",t.code,")"]},t.code))})]}),e.jsxs("label",{children:[e.jsx("span",{children:"PM"}),e.jsxs("select",{value:s.pm,onChange:t=>o({...s,pm:t.target.value}),disabled:P,children:[e.jsx("option",{value:"",children:P?"로딩 중...":"선택"}),b.map(t=>e.jsxs("option",{value:t.name,children:[t.name," (",t.role,")"]},t.id))]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"착수일"}),e.jsx("input",{type:"date",value:s.startDate,onChange:t=>o({...s,startDate:t.target.value})})]}),e.jsxs("label",{children:[e.jsx("span",{children:"종료일"}),e.jsx("input",{type:"date",value:s.endDate,onChange:t=>o({...s,endDate:t.target.value})})]}),e.jsxs("label",{children:[e.jsx("span",{children:"보안등급"}),e.jsxs("select",{value:s.securityLevel,onChange:t=>o({...s,securityLevel:t.target.value}),children:[e.jsx("option",{value:"S",children:"S등급 (최고급)"}),e.jsx("option",{value:"A",children:"A등급 (고급)"}),e.jsx("option",{value:"B",children:"B등급 (중급)"}),e.jsx("option",{value:"C",children:"C등급 (일반)"})]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"규정"}),e.jsxs("select",{value:s.regulation,onChange:t=>o({...s,regulation:t.target.value}),children:[e.jsx("option",{value:"삼성",children:"삼성"}),e.jsx("option",{value:"LG",children:"LG"}),e.jsx("option",{value:"현대자동차",children:"현대자동차"}),e.jsx("option",{value:"포스코",children:"포스코"}),e.jsx("option",{value:"한화",children:"한화"}),e.jsx("option",{value:"SK",children:"SK"}),e.jsx("option",{value:"한국전력공사",children:"한국전력공사"}),e.jsx("option",{value:"인천국제공항공사",children:"인천국제공항공사"}),e.jsx("option",{value:"기타",children:"기타"})]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"상태"}),e.jsxs("select",{value:s.status,onChange:t=>o({...s,status:t.target.value}),children:[e.jsx("option",{value:"준비",children:"준비"}),e.jsx("option",{value:"진행",children:"진행"}),e.jsx("option",{value:"완료",children:"완료"})]})]})]})]})]})}export{W as default};

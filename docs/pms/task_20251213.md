# Contract File Storage Migration - Task Checklist

## Phase 1: DB Schema (✅ 완료 - 2025-12-13)
- [x] 분석 및 계획 수립
- [x] Migration 스크립트 작성 (SQL + Node.js)
- [x] DB 컬럼 추가 실행
  - [x] `attachment_path` TEXT
  - [x] `attachment_size` BIGINT  
  - [x] `attachment_name` VARCHAR(255)
- [x] 컬럼 추가 검증 완료
- [x] Git 커밋 및 푸시

## Phase 2: Backend API (✅ 완료 - 2025-12-13)
- [x] `server/routes/contracts.js`에 Firebase Storage 통합
  - [x] Firebase Admin SDK 초기화
  - [x] Multer/Busboy 파일 업로드 처리
  - [x] Storage 업로드 로직 추가
  - [x] Signed URL 생성 API
- [x] POST `/api/contracts` 수정 (파일 업로드 지원)
  - [x] Multipart/form-data 처리
  - [x] Firebase Storage 업로드
  - [x] DB에 `attachment_path`, `attachment_size`, `attachment_name` 저장
- [x] PUT `/api/contracts/:id` 수정 (파일 업데이트 지원)
  - [x] Multipart/form-data 처리
  - [x] 동적 필드 업데이트
- [x] GET `/api/contracts/:id` 수정 (Signed URL 반환)
  - [x] Signed URL 생성 (1시간 만료)
  - [x] `attachmentUrl` 필드 추가
- [x] 로컬 테스트 준비

## Phase 3: Frontend (✅ 완료 - 2025-12-13)
- [x] `pms/src/pages/Contracts.tsx` 수정
  - [x] 파일 선택 시 File 객체 저장
  - [x] FormData 생성 및 multipart 전송
  - [x] Signed URL 기반 파일 다운로드
  - [x] 편집 시 기존 첨부파일 표시
- [x] 로컬 개발 환경 테스트 준비

## Phase 4: 배포 (⏳ 대기 중)
- [ ] Firebase Functions 배포
- [ ] Firebase Hosting 배포
- [ ] 프로덕션 테스트
- [ ] 문서 업데이트

## 다음 세션 시작 가이드
새로운 채팅 창에서:
> "파일 `docs/pms/PMS_계약견적_개발현황.md` 섹션 8을 읽고, Contract 파일 저장 방식 개선 작업을 Phase 2 (Backend API)부터 이어서 진행해줘."

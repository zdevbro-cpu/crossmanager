# PMS 임원용 대시보드 개발 계획

## 1. 목표
- **의사결정 화면**: 10초 내 “위험/손실/지연” 여부를 판단할 수 있게 요약.
- **Health Score** 기반으로 프로젝트별 리스크를 한눈에 분류하고, Top 원인 자동 제시.
- 안전·일정 중심 업종 특성(중량물/해체/안전/장비/스크랩)을 반영한 가중치와 패널 구성.

## 2. Health Score 모델 (초기 버전)
- 영역 및 가중치: 일정 25% / 안전 30% / 원가·수익 20% / 자원 15% / 품질·문서 10% (총 100점).
- 영역별 산정 로직(0~100):
  - 일정: 지연율(D = max(0, 계획-실적)), S = 100 - (D×4) - (크리티컬 지연 시 15점 패널티).
  - 안전: Sa = 100 - (미조치 NC×8) - (Near-miss 증가율×0.5) - (체크리스트 미이행률×1.0) - (사고 -30~-70).
  - 원가/수익: C = 100 - (원가 초과율×2) - (마진 목표 미달 패널티, 예: 목표 15%, 실제 5% → -30).
  - 자원(인력/장비): R = 100 - (중복 배차×5) - (장비 유휴율×0.5) - (인력 부족률×1.0) - (핵심자격 미배치 -15).
  - 품질/문서: Q = 100 - (필수 문서 미제출×10) - (보고 승인 지연일×2) - (고객 반려×15).
- 최종: Health = 0.25·S + 0.30·Sa + 0.20·C + 0.15·R + 0.10·Q.
- 등급: Green 80~100 / Yellow 65~79 / Orange 50~64 / Red 0~49.
- **강제 Red 규칙**: 중대사고/중대 near-miss, 크리티컬 공정 2주↑ 지연, 원가 초과율 15%↑ 확정, 법정 필수 안전문서 미비로 작업중지 시 무조건 Red.

## 3. 운영 규칙
- 업데이트: 임원용 일 1회 자동; 운영용 2~4시간 또는 실시간.
- 데이터 신뢰: 누락 시 0점 처리 대신 “⚠ 데이터 미수집” 플래그 표시.
- 설명 카드: 점수와 함께 Top 3 하락 원인 자동 노출(예: 체크리스트 미이행 18%, 미조치 NC 3건, 공정 지연 6%p).

## 4. 대시보드 구성 (임원 시나리오)
### Top Bar (Executive Summary)
- “오늘 기준: 위험 2건 / 지연 1건 / 손실 가능 1건” 식으로 숫자+색상+트렌드.
- 전체 프로젝트 수, 위험/주의/정상, 손실 예상 프로젝트 수.

### 1) 프로젝트 Health Index
- 프로젝트별 Health Score 카드 + 색상 등급.
- Top 5 위험 프로젝트 자동 노출(예: 원가 초과 + 안전 부적합 증가).
- 드릴다운 링크: 상세 스코어와 원인 리스트.

### 2) 안전 리스크
- 체크리스트 미이행률, 미조치 NC, Near-miss 증가 추이, 최근 30일 중대위험 작업 비율.
- 고위험 작업 조합 TOP 3(고소+중량물+야간 등).
- (Phase II) 7일 내 사고 위험 예측 리스트.

### 3) 수익/원가
- 계약금액, 실행원가, 집행액, 예상 최종 손익(EAC).
- 손실 예상 프로젝트 자동 강조(원가 초과율, 장비/인력 과다 투입, 스크랩 정산 지연).

### 4) 장비 효율 (EMS 연계)
- 전체 장비 가동률, 유휴 TOP 5, 고장 위험 TOP 3, 정비 미이행 장비 수.
- 임원 문구 예: “유휴 장비 12대 → 월 고정비 손실 약 ○○만원”.

### 5) 인력·현장 리스크
- 프로젝트별 인력 과부하/부족, 숙련/자격 보유자 투입 여부, 교육 미이수 투입 현황.

### 6) 스크랩/폐기물 리스크 & 수익
- 예상 vs 실 반출량, 정산 완료율, 비정상 반출 패턴 알림, 미정산 금액 누계.

### 7) 이슈 & 의사결정 알림
- PM 승인 대기, 안전 부적합 미조치, 손실 가능성, 장비 고장 위험 등 “결정이 필요한” 카드만 노출.

### 8) 빼야 할 것
- 상세 테이블, 엑셀형 화면, 수기 입력 필드, 모든 프로젝트 일괄 나열.
- 기본은 요약, 클릭 시 드릴다운.

## 5. 데이터 소스·업데이트
- PMS(문서/원가), EMS(장비 가동/정비), 인력/교육, 체크리스트/NC/Near-miss, 스크랩 정산.
- 집계 배치(일 1회) + 핵심 지표는 2~4시간 캐시 갱신.
- 데이터 품질 플래그: 지표별 “수집 완료/부분/미수집” 상태를 노출.

## 6. Phase II (고도화)
- 사고/지연 예측을 점수에 사전 반영, 예지정비 알림, 스크랩 이상반출/정산 리스크 탐지.

## 7. 구현 계획 (요약)
1) Health Score 계산 모듈: 영역별 스코어 함수 + 가중합 + 강제 Red 로직.
2) 데이터 집계 배치: 일 단위(임원), 2~4시간/실시간(운영) 선택.
3) API: 프로젝트별 스코어, Top 위험 프로젝트, 안전/원가/장비/스크랩 요약, 데이터 품질 플래그, Top 3 원인.
4) 대시보드 UI: Exec Summary Bar + Health 카드 + 위험 Top 리스트 + 영역별 패널(안전/원가/장비/인력/스크랩/이슈).
5) 알림 카드: 의사결정 필요 항목만 노출, 클릭 시 드릴다운.
6) 운영 튜닝: 가중치/패널티 조정, 데이터 누락 시 플래그 표준화.

## 8. 아키텍처 설계 (실무자용/임원용 분리)
### 8.1 전체 구성
- **수집/원천**: PMS(문서/원가/계약), EMS(장비), SMS(안전 체크리스트/NC/Near-miss), 스크랩/정산 시스템.
- **집계/스코어링 계층**: 백엔드 배치/워커(Health Score 계산, Top 위험/손실 프로젝트 추출, Top3 원인 산출), 캐싱 계층(Redis/Memory).
- **API 게이트웨이**: `/api/dashboard/executive/*`, `/api/dashboard/operations/*` 등 역할별 엔드포인트 분리. 공통 인증(JWT/Firebase Auth) + Role 체크(middleware).
- **프런트**: 임원용(Executive)과 실무자용(Operations) SPA를 라우트/메뉴로 분리 렌더링. 로그인 후 Role에 따라 첫 진입 대시보드 결정.
- **알림/이벤트**: 의사결정 알림(승인 대기, 미조치 NC 등) 푸시/배너용 큐.

### 8.2 역할·접근 제어
- **Role**: `executive`, `manager`, `pm`, `field`, `viewer` 등.
- **임원용**: Exec Summary, Health Top5, 안전 리스크, 손실 예상 프로젝트, 장비/스크랩 요약, 의사결정 카드만 표시. 상세 테이블/수기입력 없음.
- **실무자용**: 프로젝트 운영 상세(공정, 체크리스트, NC 처리, 장비 배차, 스크랩 정산 현황 등)와 입력/수정 기능 포함.
- **백엔드**: 미들웨어에서 Role에 따라 쿼리 범위/필드를 제한(예: 임원은 요약 집계만, 실무자는 프로젝트별 상세 접근).

### 8.3 데이터 파이프라인
- **주기**: 임원용 일 1회 집계 + 핵심 지표 2~4시간 캐시 갱신. 실시간이 필요한 알림/안전 이벤트는 이벤트 스트림으로 바로 반영.
- **스코어링 워커**:
  - 입력: 공정 진척, 크리티컬 지연, 체크리스트/NC/Near-miss, 사고, 원가/EAC, 장비 가동/유휴, 인력/자격, 문서 제출/승인, 스크랩 정산.
  - 출력: 영역별 점수, Health Score, 색상 등급, 강제 Red 여부, Top3 패널티 항목, 데이터 품질 플래그.
- **스토리지**: 원천 DB는 기존 시스템, 집계 결과는 별도 테이블/뷰(`dashboard_health_daily`, `dashboard_risks`, `dashboard_alerts`)에 저장 후 캐싱.

### 8.4 API 설계 (예시)
- `GET /api/dashboard/executive/summary`: 위험/주의/정상/손실 예상 카운트, 트렌드.
- `GET /api/dashboard/executive/projects/top-risk?limit=5`: Health Score, 등급, 주요 원인.
- `GET /api/dashboard/executive/safety`: 미이행률, 미조치 NC, Near-miss 추이, 고위험 작업 TOP.
- `GET /api/dashboard/executive/cost`: 계약/집행/EAC, 손실 예상 프로젝트 리스트.
- `GET /api/dashboard/operations/project/:id/health`: 동일 스코어 + 드릴다운(실무자만).
- 모든 API에 Role 체크 및 데이터 품질 플래그 포함.

### 8.5 프런트 분리/라우팅
- **레이아웃 분기**: 로그인 후 Role로 `ExecutiveDashboard` 또는 `OperationsDashboard` 초기 라우트.
- **컴포넌트 재사용**: 카드/차트는 공용, 표시 필드/CTA만 Role에 맞게 제어(예: 임원용은 “승인/결정” 버튼, 실무자용은 “조치/수정” 버튼).
- **빈 데이터 처리**: “⚠ 데이터 미수집” 배지 노출, 점수 대신 “수집 필요” 표시.

### 8.6 모니터링/품질
- 집계 실패/지연 알람, 데이터 품질 플래그 집계(수집률), 강제 Red 발생 시 즉시 알림.
- 가중치/패널티는 설정 테이블/Feature Flag로 운영 중 조정 가능.

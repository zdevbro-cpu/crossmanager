# 문서 구조 재구성 계획 (Document Structure Restructuring Plan)

# PMS 문서 관리 구조 변경 계획 (완료)

## 1. 개요
*   **목표**: 기존의 복잡한 테이블 뷰를 제거하고, **"폴더(Project Artifacts) 중심의 2단 카드 그리드"**와 **"우클릭 컨텍스트 메뉴"**로 모든 관리를 수행하는 초심플 UI 구현.
*   **핵심 철학**: "Ultra-Compact & Context-Menu Driven" (화면 공간 효율 극대화, 직관적인 우클릭 조작)

## 2. 변경된 데이터 구조 (반영 완료)
*   **`PmsDocument` 타입 활용**:
    *   `category`: 폴더명 (Project Artifact Name)
    *   `name`: 파일명 (Document Name)
    *   `type`: 'FOLDER' (시스템용 빈 폴더) 또는 실제 파일 타입

## 3. UI/UX 구현 상세

### A. 메인 레이아웃: 2단 폴더 그리드 (Folder Grid)
*   **구조**: 화면을 좌/우 2단(`grid-cols-2`)으로 분할.
*   **폴더 카드**: 각 카테고리(폴더)가 독립된 카드(Card) 형태로 배치됨.
*   **파일 리스트**: 카드 내부에서 파일 목록은 **1단 리스트**로 간결하게 표시.
    *   **표시 정보**: 상태 도트(색상) + 파일명.
    *   **숨김 정보**: 버전, 크기, 작성자 등은 컨텍스트 메뉴나 상세보기에만 표시.

### B. 인터랙션: Full Context Menu
1.  **헤더/빈공간 우클릭**:
    *   `[새 폴더 만들기]`: 새로운 카테고리(폴더) 생성.
2.  **폴더(카드 헤더) 우클릭**:
    *   `[새 문서 업로드]`: 해당 폴더가 선택된 상태로 업로드 모달 오픈.
    *   `[이름 변경]`: 폴더명 수정.
    *   `[폴더 삭제]`: 폴더 및 내부 파일 일괄 삭제.
3.  **파일(리스트 아이템) 우클릭**:
    *   `[상세보기]`: 문서 상세 정보 및 이력 조회.
    *   `[새 버전 업로드]`: (구현 중) 버전 업데이트 (v1.0 -> v1.1).
    *   `[인쇄 / 다운로드]`: 파일 열기/다운로드.
    *   `[삭제]`: 파일 삭제.

### C. 상세 보기 (Detail Modal)
*   **레이아웃 간소화**: 불필요한 파일 아이콘 박스를 제거하고 텍스트 위주로 개편.
*   **파일 정보**: 생성일 하단에 `첨부 파일: 파일명 (크기)` 형태로 한 줄 표시.

## 4. 진행 현황 (완료)
- [x] 백엔드: 빈 폴더 생성(`POST /folder`) 및 카테고리 관리(`PATCH/DELETE`) API 구현.
- [x] 프론트엔드: PmsDocument 타입 및 문서 조회 훅 수정.
- [x] UI: 테이블 뷰 제거 및 **2단 폴더 그리드** 구현.
- [x] UI: 문서 상태 표시(Color Dot) 적용.
- [x] 기능: 헤더/폴더/파일 컨텍스트 메뉴(Context Menu) 구현.
- [x] 기능: 문 서 업로드 모달 연동 (폴더 자동 선택).
- [x] 기능: 문서 상세 모달 UI 개선 (텍스트 중심).
- [x] 최종 테스트: 폴더 생성/삭제, 파일 업로드/삭제, 뷰어 팝업 확인.

## 5. 결론
사용자 피드백을 반영하여 **최적의 공간 활용(2단 그리드)**과 **직관적인 조작(우클릭)**을 갖춘 문서 관리 시스템이 완성되었습니다.

## 검토 요청 사항 (User Review Required)
> [!IMPORTANT]
> - 데이터베이스의 `Category`(카테고리) 필드를 "프로젝트 산출물(폴더명)"으로 사용합니다.
> - **빈 폴더 관리**: 별도의 카테고리 테이블 없이, `type='FOLDER'`, `status='SYSTEM'`인 **플레이스홀더 문서**를 생성하여 빈 폴더를 유지합니다.
> - **모든 파일은 PDF로 취급**하는 것을 원칙으로 하나, 시스템상 다른 파일 형식도 허용될 수 있습니다.

## 변경 제안 (Proposed Changes)

### 1. 프론트엔드 구성 요소 (`pms/src`)

#### [수정] [Documents.tsx](file:///c:/ProjectCode/Cross/pms/src/pages/Documents.tsx)
-   **[디자인 개선] 초소형 리스트 (Ultra-Compact)**:
    -   **컬럼 제거**: 버전, 상태, 크기 컬럼 삭제 -> **오직 파일명만 표시**.
    -   **상태 표시**: 파일명 앞에 **색상 도트(Dot)**로 상태 구분 (초록: 승인, 빨강: 반려, 회색: 작성중).
    -   **버전 확인**: 파일 우클릭 메뉴에서 현재 버전 확인 가능.
-   **[개선] 컨텍스트 메뉴 (우클릭) 중심 UX**:
    -   **헤더 ("프로젝트 산출물") 우클릭**: **[새 폴더 만들기]**. (기존 `+` 버튼 제거)
    -   **폴더 우클릭**: [이름 변경], **[새 문서 업로드]**, [폴더 삭제].
    -   **파일 우클릭**: [상세보기], [새 버전 업로드 (현재 v1.0)], [인쇄/다운로드], [삭제].
-   **기본 설정**: 모든 폴더 기본 **펼치기(Expanded)** 상태 유지.

#### [수정] [DocumentUploadModal.tsx](file:///c:/ProjectCode/Cross/pms/src/components/DocumentUploadModal.tsx)
-   **카테고리 선택 개선**:
    -   기존 고정된 옵션 대신, **현재 프로젝트에 존재하는 카테고리 목록**을 DB에서 동적으로 불러와 `datalist`에 표시.
    -   사용자는 기존 폴더를 선택하거나, 새로운 이름을 입력하여 즉석 폴더 생성 가능.

### 2. 백엔드 API (`server/index.js`)

#### [추가] 폴더 관리 API
-   `POST /api/documents/folder`: 빈 폴더 생성 (파일 없는 메타데이터 생성).
-   `PATCH /api/documents/category`: 카테고리명 일괄 변경.
    -   Body: `{ projectId, oldCategory, newCategory }`
-   `DELETE /api/documents/category`: 카테고리 및 하위 문서 일괄 삭제.
    -   Query: `?projectId=...&category=...`

## 검증 계획 (Verification Plan)

### 수동 검증 (Manual Verification)
1.  **폴더 관리**:
    -   `+` 버튼으로 '기획서' 폴더 생성 -> 화면에 빈 폴더 표시 확인.
    -   우클릭 -> 이름 변경 -> '기획서 v2'로 변경 -> 즉시 반영 확인.
2.  **업로드 연동**:
    -   업로드 모달 진입 -> 카테고리 입력란 클릭 -> '기획서 v2'가 목록에 뜨는지 확인.
    -   파일 업로드 후 해당 폴더에 들어가는지 확인.
3.  **삭제**:
    -   우클릭 -> 삭제 -> 경고창 -> 확인 시 폴더와 파일 모두 사라지는지 확인.

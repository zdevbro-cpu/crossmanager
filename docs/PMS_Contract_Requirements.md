# PMS 계약 및 견적 관리 모듈 구현 계획 및 요구사항 (Contract Module Plan)

## 목표 설명 (Goal Description)
프로젝트 수주를 위한 **견적(Estimate)** 산출부터 **계약(Contract)** 체결, 그리고 **변경(Change)** 관리까지의 금전적 흐름을 통합 관리합니다.
실행 예산 수립 시 간접비/이윤 등을 시뮬레이션하고, 고객사 맞춤형 견적서를 출력할 수 있어야 합니다.

## 사용자 검토 필요 사항 (User Review Required)
> [!IMPORTANT]
> **금액 권한**: 도급액, 실행예산 등 민감한 금액 정보는 직급에 따라 **조회/수정 권한**이 엄격히 분리되어야 합니다. (현장 소장은 실행예산만 조회 가능 등).
> **전자 결재**: 계약 체결 상태 변경 시, PMS 내부 승인만으로 충분한지, 그룹웨어 전자결재 연동이 필요한지 확인 필요. (1단계는 자체 승인으로 구현).

## 기능 명세 및 구현 사항 (Functional Specifications)

### 1. 데이터베이스 설계 (Database Schema)
#### [MODIFY] `contracts` (계약 헤더)
- `type`: EST(견적), CONTRACT(계약), CHANGE(변경) 구분.
- `financials`: 도급액, 실행가(재료/노무/경비), 이윤, 리스크비용 컬럼 구성.
- `regulation_config`: 고객사별 제출 서류 체크리스트 (JSON).

#### [MODIFY] `contract_items` (세부 내역)
- `group`, `name`, `spec`, `quantity`, `unit`, `unit_price`, `amount` 표준 내역 구조.

### 2. 주요 기능 로직 (Key Features)

#### 금액 시뮬레이션
- **기능**: 직접비(재료+노무+경비) 합계에 대해 간접비율(%), 이윤율(%) 입력 시 전체 도급액 자동 계산(정방향).
- **역산**: 목표 도급액 입력 시 이윤율 자동 조정(역방향) 기능 (선택 사항).

#### 견적서 출력
- **Template**: 갑지(표지) + 을지(내역서) 형태로 브라우저 프린팅 최적화된 HTML 렌더링.

### 3. 프론트엔드 UI/UX (Frontend)

#### [MODIFY] `pms/src/pages/Contracts.tsx`
- **Spreadsheet Mode**: 내역서 입력 시 엑셀처럼 엔터 키로 다음 셀 이동, 탭으로 이동 등 고속 입력 지원.
- **파일 뷰어**: 계약서 스캔본(PDF/Image) 바로보기 버튼 제공.

## 검증 계획 (Verification Plan)

### 시나리오 테스트
1.  **금액 검증**: 수량 10, 단가 100 입력 시 금액 1000 자동 계산 및 총액 반영 확인.
2.  **출력 테스트**: 견적서 출력 버튼 클릭 시, 미리보기 화면이 깨지지 않고 A4 규격에 맞게 나오는지 확인.
3.  **변경 이력**: 설계 변경(Change Order) 생성 시 원 계약과 연결 관계가 유지되는지 확인.

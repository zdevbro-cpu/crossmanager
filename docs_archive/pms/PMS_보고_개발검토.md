# PMS 통합 보고 모듈 개발 검토 보고서

## 1. 검토 개요
본 문서는 `PMS_보고_개발계획.md`에서 제안된 **전사 통합 보고 체계**의 실현 가능성을 평가하기 위해, 현재 운영 중인 서브시스템(PMS, SMS, SWMS, EMS)의 코드 및 데이터 구조를 정밀 분석한 결과를 정리한 것입니다.

**검토 일자:** 2025-12-12
**검토 대상:** `server/index.js`, `server/routes/*`, Database Schema

## 2. 서브시스템 현황 분석 (AS-IS Analysis)

현재 시스템의 데이터 준비 상태를 **[준비됨 / 부분적 / 미흡]** 3단계로 평가했습니다.

### 2.1 PMS (프로젝트 관리) - [준비됨]
*   **핵심 데이터:** `projects`, `tasks`(공정), `resources`, `contracts`, `documents` 테이블이 이미 구현되어 운영 중.
*   **보고 연동성:**
    *   **공정 보고:** `tasks` 테이블의 `progress`, `start_date`, `end_date`를 통해 Gantt/지연율 자동 산출 가능.
    *   **자원 보고:** `resource_assignments` 테이블을 통해 인력/장비 투입 현황 집계 가능.
*   **특이사항:** WBS(Task) 구조가 트리 형태(`parent_task_id`)로 잘 설계되어 있어 공정 집계가 용이함.

### 2.2 SMS (안전 관리) - [매우 우수]
*   **핵심 데이터:** `sms_risk_assessments`, `sms_dris`, `sms_patrols`, `sms_checklists`, `sms_incidents` 등 안전 관련 전 테이블이 매우 상세하게 정의됨.
*   **보고 연동성:**
    *   **일일 보고:** DRI(일일위험예측), 패트롤 점검 결과를 즉시 가져와 일일보고 안전 섹션에 삽입 가능.
    *   **사고 보고:** 사고 발생 시(`sms_incidents`) 트리거를 통해 즉시 보고서 초안 생성 가능.
*   **특이사항:** 데이터 구조가 가장 체계적이며, 사진(`photo_url`) 연동도 잘 되어 있어 보고서 자동화 효과가 가장 클 것으로 예상됨.

### 2.3 EMS (장비 관리) - [준비됨]
*   **핵심 데이터:** `equipment` 테이블 하나에 스펙, 유지보수, 보험, 비용 등 방대한 속성이 정의되어 있음.
*   **보고 연동성:**
    *   **가동률:** `operating_hours`, `downtime_hours` 등 필드가 존재하여 가동률 분석 가능.
    *   **비용:** `fuel_cost`, `maintenance_cost` 등 비용 데이터가 이미 스키마에 포함됨.
*   **보완점:** 장비별 '일일 가동 기록(Log)' 테이블은 별도로 보이지 않아, `equipment` 테이블의 누적치(`accumulated_hours`)를 매일 스냅샷 찍거나 별도 로그 테이블이 필요할 수 있음.

### 2.4 SWMS (스크랩/폐기물) - [확인 필요 / 부분적]
*   **핵심 데이터:** `server/index.js`에서는 `swms_inventory_snapshots`만 확인됨. 실제 로직은 `swms_routes.js`로 분리되어 있어 상세 스키마 추가 확인 필요.
*   **보고 연동성:** 계근 데이터 기반의 정산 보고서 생성이 핵심이므로, `weighbridge` 관련 테이블 존재 여부가 중요.
*   **평가:** 별도 라우트 파일(`swms_routes.js`)로 모듈화되어 있어 통합 시 API 호출 방식 고려 필요.

## 3. 갭 분석 (Gap Analysis)

계획된 통합 보고 모듈을 구현하기 위해 현재 부족한 요소들입니다.

| 부족함(Missing) | 중요도 | 설명 |
| :--- | :--- | :--- |
| **통합 보고서 DB** | **High** | 생성된 보고서(스냅샷)를 저장할 `reports` 테이블 부재. |
| **템플릿 엔진** | **High** | 보고서 양식(HTML/Layout)을 정의하고 데이터를 주입할 엔진 부재. |
| **결재(Approval)** | **Medium** | 보고서 승인/반려를 처리할 결재 워크플로우 테이블 부재. |
| **데이터 집계기** | **High** | 흩어진 4개 모듈의 데이터를 하나로 모으는 `Aggregator` 서비스 로직 필요. |

## 4. 실현 가능성 및 제안 (Feasibility & Proposal)

### 4.1 종합 평가: **[높음 (High Feasibility)]**
기존 데이터(SMS, PMS, EMS)가 예상보다 훨씬 구조적으로 잘 갖춰져 있어, 맨바닥에서 시작하는 것이 아니라 **"잘 차려진 데이터를 모아서 보여주기만 하면 되는"** 유리한 상황입니다.

### 4.2 개발 전략 제안

**1단계: Core 구축 (Backend)**
*   `reports`, `report_templates` 테이블 생성.
*   PMS/SMS/EMS 데이터를 조회하여 JSON으로 리턴해주는 `DataAggregator` 함수 구현.

**2단계: 일일 작업 보고서 (Daily Report) 우선 구현**
*   가장 활용도가 높고 데이터가 풍부한 **일일 보고**부터 자동화.
*   구성: [PMS 공정 현황] + [SMS 안전 점검] + [인력/장비 투입].

**3단계: UI/UX (Report Builder)**
*   복잡한 에디터 대신, 미리 정의된 섹션을 On/Off 하는 방식의 심플한 빌더 제공.

**결론:**
현재 아키텍처 그대로 진행해도 무방하며, 리스크는 낮습니다. 제공해주신 개발 계획(`PMS_보고_개발계획.md`)대로 진행하는 것을 추천합니다.

2025-12-28 작업 정리

완료된 내용
- Cloud SQL Proxy 접속/권한 설정 확인 및 TCP 연결 전환 테스트 완료
- Functions 배포 재정비 및 /api/test 확인 완료
- SWMS 초기화 오류 해결: swms_material_types.code NOT NULL, vendors seed 보완
- SWMS 대시보드 500 해결: dashboard 관련 테이블 생성, 쿼리 오류/인코딩 깨짐 수정
- swms/weighings site_id 타입 불일치 수정 (text cast)
- SWMS 샘플 데이터 삽입 스크립트 추가 및 실행
  - EMS/SMS/SWMS 샘플 데이터 생성
  - SWMS sites/companies 없을 경우 자동 생성
- SMS 요청 503 이슈 확인 및 API 응답 정상화

현재 확인된 상태
- SWMS sites API: https://crossmanagern.web.app/api/swms/sites/my 에서 FAC-001 반환됨
- 실제 DB에는 UUID site_id 기반으로 샘플 데이터가 들어가 있음
- PMS 로그인 시 포털로 되돌아가는 현상 발생
- PMS는 Firebase 환경이 crossmanager-1e21c로 남아 있어 인증 실패 가능성 높음

추가 진행 필요
1) PMS 로그인/SSO
   - PMS Login: Firebase env mismatch 수정 필요 (crossmanager-482403 웹앱 설정값 적용)
   - 로컬 fallback 로그인 허용 옵션 추가됨 (VITE_ALLOW_LOCAL_LOGIN=true)
   - PMS 재빌드/재배포 필요
2) SWMS 사이트 ID 정합성
   - /api/swms/sites/my가 DB UUID를 반환하도록 추가 보완 배포 완료
   - 재확인 필요 (UUID가 반환되면 그 값으로 SWMS API 호출)
3) Hosting 재배포
   - PMS 변경 사항 반영을 위해 build_all.ps1 + firebase deploy --only hosting 필요

관련 변경 파일
- functions/routes/swms.js
- scripts/seed_sample_data.js
- pms/src/hooks/useAuth.tsx
- pms/src/pages/Login.tsx
- pms/.env.production

메모
- 현재 Firebase 프로젝트/환경변수는 Portal/PMS/EMS/SMS/SWMS 모두 crossmanager-1e21c로 설정되어 있어
  실제 로그인/SSO 사용 시 crossmanager-482403의 웹앱 설정값으로 전환 필요.
